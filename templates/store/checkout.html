{% extends 'base.html' %}
{% load static %}

{% block content %}
{% load humanize %}
{% load static %}
{% include 'includes/header.html' %}

<section class="section-content padding-y bg">
    <div class="container">

    <!-- ============================ COMPONENT 1 ================================= -->
    <div class="row">
        <aside class="col-lg-6">
            {% include 'includes/alerts.html' %}


            <div class="card mb-4">
                <div class="card-body">
                    <h4 class="card-title mb-4">Customer details</h4>
                    <div class="form-row mb-4">
                        <div class="col-12 row">
                            <div class="col-2">
                                <label class="m-0 text-muted" for="name">Name :</label>
                            </div>
                            <div class="col">
                                <input id="name" type="text" value="{{user.first_name}} {{user.last_name}}" class="border-0 font-weight-bold" readonly>
                            </div>
                        </div>
                        <div class="col-12 row">
                            <div class="col-2">
                                <label class="m-0 text-muted" for="email">Email :</label>
                            </div>
                            <div class="col">
                                <input id="email" type="email" value="{{user.email}}" class="border-0 font-weight-bold" readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-4">Shipping Address</h4>

                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#addressModal">
                        Add a new address
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="adressModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="adressModalLabel">Create New Address</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div>
                            <div class="modal-body">
                                <form action="{% url 'add_address' source='checkout' %}" method="POST">
                                    {% csrf_token %}
                                    {{address_form.as_p}}
                                
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-outline-primary">Add address</button>
                        </form>
                            </div>
                        </div>
                        </div>
                    </div>
    <!-- EndModal -->

                    <form action="{% url 'order_summary' %}" method="POST">
                        {% csrf_token %}
                    {% for address in addresses %}
                    <div class="form-check border border-dark my-2">
                        <div class="p-2">
                            
                            <input value="{{ address.id }}" class="form-check-input" type="radio" name="address" id="address{{ forloop.counter }}" {% if address.is_default %}checked{% endif %}>
                            <label class="form-check-label" for="address{{ forloop.counter }}">
                                {{ address.get_user_full_address|slice:":80"|safe }}...
                            </label>
                        </div>
                    </div>
                    {% endfor %}
    
                </div>

            </div> <!-- card.// -->
            <div class="card mt-1">
                <div class="card-body">
                    <div class="form-row row mt-2">
                        <div class="col form-group">
                            <label for="id_order_note">Order Note</label>
                            <textarea id="id_order_note" name="order_note" rows="2" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>

        </aside> <!-- col.// -->
        <aside class="col-lg-6">

            <div class="card">
                <div class="card-body">
                    <table class="table table-borderless table-shopping-cart">
                        <thead class="text-muted">
                            <tr class="small text-uppercase">
                                <th scope="col">Product</th>
                                <th scope="col" width="120">Quantity</th>
                                <th scope="col" width="120">Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cart_item in cart_items %}
                                <tr>
                                    <td>
                                        <figure class="itemside align-items-center">
                                            <div class="aside"><img src="{{cart_item.product.thumbnail_image.url}}" style="width: 80px;"></div>
                                            <figcaption class="info">
                                                <a href="{{cart_item.product.get_url}}" class="title text-dark">{{cart_item.product.get_product_name}} {{cart_item.product.brand.brand_name}}</a>
                                                <p class="text-muted small">
                                                    {% for value in cart_item.product.attributes.all %}
                                                        {{value.attribute}}: {{value.attribute_value}}
                                                        <br>
                                                    {% endfor %}
                                                    Brand: {{cart_item.product.product.brand}}
                                                </p>
                                            </figcaption>
                                        </figure>
                                    </td>
                                    <td>
                                        <label>{{cart_item.qty}}</label>
                                    </td>
                                    <td> 
                                        <div class="price-wrap"> 
                                            <var class="price">&#8377;{{cart_item.subtotal|intcomma}}</var> 
                                            <small class="text-muted">&#8377; {{cart_item.product.product_price|intcomma}} each </small> 
                                        </div> <!-- price-wrap .// -->
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <div class="px-3">
                        <dl class="dlist-align">
                            <dt>Total price:</dt>
                            <dd class="text-right">&#8377; {{ max_total|intcomma }}</dd>
                        </dl>

                        <dl class="dlist-align">
                            <dt>Discount:</dt>
                            <dd class="text-right text-success">&#8377; {{discount|intcomma}}</dd>
                        </dl>
                        
                        <dl class="dlist-align">
                            <dt>Grand Total:</dt>
                            <dd class="text-right text-dark b"><strong> <span id="grand_total_checkout">&#8377; {{ grand_total|intcomma }} </span> </strong></dd>
                        </dl>
                        
                        <dl class="dlist-align">
                            <dt>Tax:</dt>
                            <dd class="text-right text-danger">&#8377; {{ tax|intcomma }}</dd>
                        </dl>
                    </div>
                    <hr>
                    <p class="text-center mb-3">
                        <img src="{% static 'accounts/images/misc/payments.png' %}" height="26">
                    </p>


                    <button type="submit" class="btn btn-primary btn-block"> Place order </button>
                    <a href="{% url 'product_store' %}" class="btn btn-light btn-block">Continue Shopping</a>
                </form>
                </div> <!-- card-body.// -->
            </div> <!-- card.// -->

        </aside> <!-- col.// -->

    </div> <!-- row.// -->
    <!-- ============================ COMPONENT 1 END .// ================================= -->

    </div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->
{% endblock %}